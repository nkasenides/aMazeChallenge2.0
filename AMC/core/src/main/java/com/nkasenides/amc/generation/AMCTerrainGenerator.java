/* --------------------------------------------------------------------------------
  This file was automatically generated by the Athlos Project Editor.
  Athlos Framework: http://nkasenides.github.io/athlos
  Generated on: 12-08-2021 11:56:05
  Athlos Project Editor, v0.1.0 BETA
-------------------------------------------------------------------------------- */

package com.nkasenides.amc.generation;

import com.nkasenides.amc.model.*;
import com.nkasenides.amc.proto.*;
import com.nkasenides.athlos.model.TerrainGenerator;
import com.raylabz.jsec.Hashing;
import com.nkasenides.athlos.exception.ChunkOutOfBoundsException;
import java.util.HashMap;
import java.util.UUID;

public class AMCTerrainGenerator extends TerrainGenerator<AMCWorld, AMCTerrainChunk, AMCTerrainCell>{

    public AMCTerrainGenerator(AMCWorld world) {
        super(world);
    }

    protected final AMCTerrainCell generateCell(int cellRow, int cellCol) {    
        final AMCTerrainCell cell = new AMCTerrainCell();        
        cell.setPosition(new MatrixPosition(cellRow, cellCol));        
        //TODO - Define custom cell properties here.        
        return cell;        
    }    
    
    public final AMCTerrainCell acquireCell(final int cellRow, final int cellCol) throws ChunkOutOfBoundsException {
        if (world.cellIsInBounds(cellRow, cellCol)) {
            return generateCell(cellRow, cellCol);
        }
        else {
            throw new ChunkOutOfBoundsException(cellRow, cellCol);
        }
    }

    public final AMCTerrainChunk generateChunk(final int chunkRow, final int chunkCol) {

        final int chunkStartRow = AMCTerrainChunk.getChunkStartRowFromChunkRow(chunkRow);
        final int chunkLastRow = AMCTerrainChunk.getChunkLastRowFromChunkRow(chunkRow);
        final int chunkStartCol = AMCTerrainChunk.getChunkStartColFromChunkCol(chunkCol);
        final int chunkLastCol = AMCTerrainChunk.getChunkLastColFromChunkCol(chunkCol);

        AMCTerrainChunk chunk = new AMCTerrainChunk();
        chunk.setWorldID(world.getId());
        chunk.setId(UUID.randomUUID().toString());
        chunk.setPosition(new MatrixPosition(chunkRow, chunkCol));
        HashMap<String, AMCTerrainCell> cells = new HashMap<>();

        for (int c = chunkStartCol; c <= chunkLastCol; c++) {
            for (int r = chunkStartRow; r <= chunkLastRow; r++) {
                AMCTerrainCell cell = acquireCell(r, c);
                cells.put(Hashing.hash(r + "," + c), cell);
            }
        }
        chunk.setCells(cells);

        return chunk;
    }

}

